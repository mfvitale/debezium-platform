╔════════════════════════════════════════════════════════════════════════════╗
║                 CYPRESS E2E TESTING WORKFLOW                                 ║
║                  Debezium Platform Stage                                     ║
╚════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│ STEP 1: Start Backend Services                                              │
└─────────────────────────────────────────────────────────────────────────────┘

   Terminal 1:
   $ cd ../debezium-platform-conductor/dev
   $ docker compose up -d

   Services Started:
   ┌──────────────────┐        ┌──────────────────┐
   │   PostgreSQL     │◄───────┤   Conductor      │
   │   Port: 5432     │        │   Port: 8080     │
   └──────────────────┘        └──────────────────┘

   Wait ~30-60 seconds for initialization

┌─────────────────────────────────────────────────────────────────────────────┐
│ STEP 2: Verify Backend Health                                               │
└─────────────────────────────────────────────────────────────────────────────┘

   $ curl http://localhost:8080/api/pipelines
   
   Expected: 200 OK or valid response

┌─────────────────────────────────────────────────────────────────────────────┐
│ STEP 3: Run Cypress Tests (Choose One Method)                               │
└─────────────────────────────────────────────────────────────────────────────┘

   METHOD A: Automated Script (Recommended)
   ┌────────────────────────────────────────────────────────────────────┐
   │ $ ./run-e2e-tests.sh                                               │
   │                                                                    │
   │ Options:                                                           │
   │   --headless    Run in headless mode                              │
   │   --chrome      Run in Chrome browser                             │
   │   --firefox     Run in Firefox browser                            │
   └────────────────────────────────────────────────────────────────────┘

   METHOD B: Yarn Commands (Interactive)
   ┌────────────────────────────────────────────────────────────────────┐
   │ $ yarn e2e              # Starts dev server + opens Cypress UI    │
   │ $ yarn e2e:ci           # Starts dev server + runs headless       │
   └────────────────────────────────────────────────────────────────────┘

   METHOD C: Manual Control
   ┌────────────────────────────────────────────────────────────────────┐
   │ Terminal 2: $ yarn dev                                            │
   │ Terminal 3: $ yarn cypress:open                                   │
   └────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ Test Execution Flow                                                          │
└─────────────────────────────────────────────────────────────────────────────┘

   ┌─────────────────────────────────────────────────────────────────────┐
   │  1. cy.waitForBackend()                                             │
   │     └─► Check: GET http://localhost:8080/api/pipelines             │
   └──────────────────────────────────┬──────────────────────────────────┘
                                      │
                                      ▼
   ┌─────────────────────────────────────────────────────────────────────┐
   │  2. cy.visit('/')                                                   │
   │     └─► Load: http://localhost:3000/                               │
   └──────────────────────────────────┬──────────────────────────────────┘
                                      │
                                      ▼
   ┌─────────────────────────────────────────────────────────────────────┐
   │  3. Run Test Assertions                                             │
   │     ├─► Check: Page title                                           │
   │     ├─► Check: UI elements                                          │
   │     ├─► Check: Navigation                                           │
   │     └─► Check: API responses                                        │
   └─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ Test Files Created                                                           │
└─────────────────────────────────────────────────────────────────────────────┘

   cypress/
   ├── e2e/
   │   ├── smoke.cy.ts           ← 5 tests: Basic app loading
   │   └── navigation.cy.ts      ← 6 tests: Route navigation
   ├── support/
   │   ├── commands.ts           ← Custom: cy.waitForBackend()
   │   └── e2e.ts                ← Global setup
   ├── fixtures/
   │   └── example.json          ← Sample test data
   └── tsconfig.json             ← TypeScript config

┌─────────────────────────────────────────────────────────────────────────────┐
│ Quick Commands Reference                                                     │
└─────────────────────────────────────────────────────────────────────────────┘

   Start Backend:
   $ cd ../debezium-platform-conductor/dev && docker compose up -d

   Check Backend API:
   $ curl http://localhost:8080/api/pipelines

   Run Tests (Interactive):
   $ yarn e2e

   Run Tests (Headless):
   $ yarn e2e:ci

   Run Tests (with dev server already running):
   $ yarn cypress:open        # Interactive
   $ yarn cypress:run         # Headless

   Stop Backend:
   $ cd ../debezium-platform-conductor/dev && docker compose down

┌─────────────────────────────────────────────────────────────────────────────┐
│ Troubleshooting                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

   Backend not responding:
   $ docker compose logs -f conductor

   Port conflicts:
   $ lsof -i :3000
   $ lsof -i :8080

   Verify Cypress installation:
   $ npx cypress verify

   Clear Cypress cache:
   $ npx cypress cache clear
   $ yarn install --force

╔════════════════════════════════════════════════════════════════════════════╗
║  For detailed documentation, see:                                           ║
║  - E2E_TESTING_GUIDE.md         (Quick start guide)                        ║
║  - CYPRESS_SETUP_SUMMARY.md     (Complete setup details)                   ║
║  - cypress/README.md            (Detailed testing guide)                   ║
╚════════════════════════════════════════════════════════════════════════════╝

